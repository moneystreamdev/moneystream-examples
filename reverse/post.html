<head>
    <!-- <meta name="monetization" content="1KUrv2Ns8SwNkLgVKrVbSHJmdXLpsEvaDf"> -->
  
    <script>
      const sessionId = create_UUID()
      console.log(`session ${sessionId}`)
      let payTo = "133hMAzFDT4R8KRUqoQggv1UvcuyePzRn5"
      let total = 0
      let sendAmount = 0
      let scale

      window.addEventListener('load', () => {
  
        var myTimer = null

          // authorize faucet to send money to user
          const dto = {
            session: sessionId,
            payTo: payTo
          }
          //let url = 'https://cash.bitcoinofthings.com/faucet/progress'
          let url = 'http://localhost:9900/faucet/progress'
          fetch(url, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            // mode: 'no-cors',
            body: JSON.stringify(dto)
          }).then(function(response) {
            // console.log(response)
            return response.json()
          }).then(function(data) {
            // const data = {
            //   assetScale: 8,
            //   assetCode:"BSV",
            //   amount: sendAmount
            // }
            console.log(data)
            sendAmount += 1
            // fire reverse monetizationprogress
            whenReverseMonetizationProgress(
              data
            )
          })

      })

      function whenReverseMonetizationProgress(payment) {
        // initialize currency and scale on first progress event
        if (total === 0) {
          scale = payment.assetScale
          document.getElementById('currency').innerText = payment.assetCode
        }
        // amount is the total cumulative amount
        total = Number(payment.amount)
        const formatted = (total * Math.pow(10, -scale)).toFixed(scale)
        document.getElementById('total').innerText = formatted
      }

    function create_UUID(){
      var dt = new Date().getTime()
      var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
          var r = (dt + Math.random()*16)%16 | 0
          dt = Math.floor(dt/16)
          return (c=='x' ? r :(r&0x3|0x8)).toString(16)
      })
      return uuid
    }

    </script>
  </head>
  
  <body>

    <p>
      You have received
      <span id="total">nothing (yet)</span>
      <span id="currency"></span>
    </p>

  </body>
