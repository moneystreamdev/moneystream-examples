<html>
    <head>
        <title>MoneyStream in Browser</title>
        <script type="module" src="https://staging.bitcoinofthings.com/moneystream.js"></script>
        <script>
            function makeCommand(cmd) {
                return {command: cmd}
            }
            document.addEventListener(`DOMContentLoaded`, () => {
                //TODO: improve getting reference to module export
                const postmess = window.postmess
                const btnstop = document.getElementById(`stop`)
                const btnstart = document.getElementById(`start`)
                const btnupdate = document.getElementById(`update`)
                const btnbalance = document.getElementById(`balance`)
                btnstart.addEventListener('click', (e) => {
                    e.preventDefault()
                    postmess(makeCommand('start'))
                })
                btnstop.addEventListener('click', (e) => {
                    e.preventDefault()
                    postmess(makeCommand('stop'))
                })
                btnupdate.addEventListener('click', (e) => {
                    e.preventDefault()
                    postmess(makeCommand('balance'))
                })
                btnbalance.addEventListener('click', (e) => {
                    e.preventDefault()
                    //TODO: check origin???
                    console.log(e)
                    postmess(makeCommand('getbalance'))
                })
            })

            window.onload = function() {
                window.addEventListener('message', function(e) {
                    var message = e.data
                    console.log(message)
                })
            }
        </script>
        <style>
            /* .moneystream {
                height: 40px;
            } */
        </style>
    </head>
    <body>
        <div>A test page for moneystream in browser</div>
        <div id="moneystream-placeholder" class="moneystream"
            data-to="fullcycle@moneybutton.com"
        ></div>
        <div>
            <div>
                Application goes here
            </div>
            <div>
                <button id="start">start</button>
                <button id="stop">stop</button>
                <button id="update">update</button>
                <button id="balance">balance</button>
            </div>
        </div>
    </body>
</html>